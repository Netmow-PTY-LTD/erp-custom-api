# Database Schema Documentation for Routes

## How to Add Database Information to routesMeta

You can add database schema information to any route in the `routesMeta` array. This helps developers understand which tables and fields are involved in each endpoint.

## Structure

```javascript
{
    path: '/endpoint',
    method: 'GET',
    handler: controllerFunction,
    description: 'Endpoint description',
    
    // Add this database object
    database: {
        tables: ['table1', 'table2'],           // All tables involved
        mainTable: 'table1',                     // Primary table
        
        // For GET/LIST endpoints
        fields: {
            table1: ['field1', 'field2', ...],
            table2: ['field1', 'field2', ...]
        },
        
        // For POST/CREATE endpoints
        requiredFields: ['field1', 'field2'],    // Required fields
        optionalFields: ['field3', 'field4'],    // Optional fields
        autoGeneratedFields: ['id', 'created_at'], // Auto-generated
        
        // For all endpoints
        relationships: [
            'table1.foreign_key -> table2.id (FK)',
            'table1.field -> table2.field'
        ]
    }
}
```

## Examples

### GET Endpoint (List/Read)

```javascript
{
    path: '/',
    method: 'GET',
    handler: (req, res) => productsController.getAllProducts(req, res),
    description: 'List all products',
    database: {
        tables: ['products', 'categories', 'units', 'product_images'],
        mainTable: 'products',
        fields: {
            products: ['id', 'name', 'sku', 'price', 'stock_quantity', 'initial_stock'],
            categories: ['id', 'name'],
            units: ['id', 'name', 'symbol'],
            product_images: ['id', 'product_id', 'image_url']
        },
        relationships: [
            'products.category_id -> categories.id',
            'products.unit_id -> units.id',
            'product_images.product_id -> products.id'
        ]
    }
}
```

### POST Endpoint (Create)

```javascript
{
    path: '/',
    method: 'POST',
    handler: (req, res) => productsController.createProduct(req, res),
    description: 'Create a new product',
    database: {
        tables: ['products', 'product_images'],
        mainTable: 'products',
        requiredFields: ['name', 'sku', 'price', 'category_id', 'unit_id'],
        optionalFields: ['description', 'cost', 'stock_quantity', 'initial_stock'],
        autoGeneratedFields: ['id', 'created_at', 'updated_at'],
        relationships: [
            'products.category_id -> categories.id (FK)',
            'products.unit_id -> units.id (FK)'
        ]
    }
}
```

### PUT Endpoint (Update)

```javascript
{
    path: '/:id',
    method: 'PUT',
    handler: (req, res) => productsController.updateProduct(req, res),
    description: 'Update a product',
    database: {
        tables: ['products'],
        mainTable: 'products',
        updatableFields: ['name', 'sku', 'price', 'stock_quantity', 'initial_stock'],
        readOnlyFields: ['id', 'created_at'],
        autoUpdatedFields: ['updated_at']
    }
}
```

### DELETE Endpoint

```javascript
{
    path: '/:id',
    method: 'DELETE',
    handler: (req, res) => productsController.deleteProduct(req, res),
    description: 'Delete a product',
    database: {
        tables: ['products', 'product_images'],
        mainTable: 'products',
        cascadeDeletes: [
            'product_images (ON DELETE CASCADE)'
        ]
    }
}
```

## Complete Example - Sales Order

```javascript
{
    path: '/orders',
    method: 'POST',
    handler: (req, res) => salesController.createOrder(req, res),
    description: 'Create a new sales order',
    database: {
        tables: ['orders', 'order_items', 'customers', 'products', 'stock_movements'],
        mainTable: 'orders',
        requiredFields: ['customer_id', 'items'],
        optionalFields: ['shipping_address', 'billing_address', 'notes', 'due_date'],
        autoGeneratedFields: ['id', 'order_number', 'total_amount', 'created_at', 'updated_at'],
        relationships: [
            'orders.customer_id -> customers.id (FK)',
            'order_items.order_id -> orders.id (FK)',
            'order_items.product_id -> products.id (FK)',
            'stock_movements.reference_id -> orders.id (when reference_type=order)'
        ],
        sideEffects: [
            'Decreases products.stock_quantity',
            'Creates stock_movements records',
            'Updates product stock levels'
        ]
    }
}
```

## Benefits

1. **Better Documentation**: Developers can see exactly which tables are affected
2. **Database Schema Visibility**: Shows relationships and field requirements
3. **API Understanding**: Clear view of what data is needed and returned
4. **Migration Planning**: Helps identify database dependencies
5. **Testing**: Know which tables to check when testing endpoints

## Usage in Routes Tree

When viewing `/routes-tree`, the database information will be displayed alongside the route documentation, making it easy to understand the complete data flow.

## Recommended Fields

### For All Routes
- `tables`: Array of all involved tables
- `mainTable`: The primary table being operated on
- `relationships`: Foreign key relationships

### For GET/LIST
- `fields`: Object mapping tables to their returned fields

### For POST/CREATE
- `requiredFields`: Fields that must be provided
- `optionalFields`: Fields that can be provided
- `autoGeneratedFields`: Fields generated by the system

### For PUT/UPDATE
- `updatableFields`: Fields that can be updated
- `readOnlyFields`: Fields that cannot be updated
- `autoUpdatedFields`: Fields automatically updated (like timestamps)

### For DELETE
- `cascadeDeletes`: Related tables that will be affected

### Optional
- `sideEffects`: Other database changes that occur (like stock updates)
- `triggers`: Database triggers that fire
- `indexes`: Important indexes used for this query

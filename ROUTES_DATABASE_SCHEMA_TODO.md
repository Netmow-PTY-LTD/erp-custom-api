// Script to add database schema to all routes
// This file documents which routes need database info added

## Products Module - Remaining Routes

### GET /api/products/:id
database: {
    tables: ['products', 'categories', 'units', 'product_images'],
    mainTable: 'products',
    fields: {
        products: ['id', 'name', 'sku', 'description', 'category_id', 'unit_id', 'price', 'cost', 'stock_quantity', 'initial_stock', 'min_stock_level', 'max_stock_level', 'barcode', 'image_url', 'weight', 'length', 'width', 'height', 'is_active', 'created_at', 'updated_at'],
        categories: ['id', 'name', 'description'],
        units: ['id', 'name', 'symbol'],
        product_images: ['id', 'product_id', 'image_url', 'sort_order']
    },
    relationships: [
        'products.category_id -> categories.id (FK)',
        'products.unit_id -> units.id (FK)',
        'product_images.product_id -> products.id (FK)'
    ]
}

### PUT /api/products/:id
database: {
    tables: ['products', 'product_images'],
    mainTable: 'products',
    updatableFields: ['name', 'sku', 'description', 'category_id', 'unit_id', 'price', 'cost', 'stock_quantity', 'initial_stock', 'min_stock_level', 'max_stock_level', 'barcode', 'image_url', 'weight', 'is_active'],
    readOnlyFields: ['id', 'created_at'],
    autoUpdatedFields: ['updated_at']
}

### DELETE /api/products/:id
database: {
    tables: ['products', 'product_images', 'order_items', 'purchase_order_items'],
    mainTable: 'products',
    cascadeDeletes: ['product_images (ON DELETE CASCADE)']
}

### PUT /api/products/:id/stock
database: {
    tables: ['products', 'stock_movements'],
    mainTable: 'products',
    updatedFields: ['stock_quantity'],
    sideEffects: [
        'Creates stock_movements record',
        'Records movement_type (purchase/sale/adjustment)',
        'Stores quantity change (positive or negative)',
        'Links to reference (order, purchase_order, or manual)'
    ]
}

### GET /api/products/:id/stock/movements
database: {
    tables: ['stock_movements', 'products'],
    mainTable: 'stock_movements',
    fields: {
        stock_movements: ['id', 'product_id', 'movement_type', 'quantity', 'reference_type', 'reference_id', 'notes', 'created_by', 'created_at']
    },
    relationships: ['stock_movements.product_id -> products.id (FK)']
}

### POST /api/products/categories
database: {
    tables: ['categories'],
    mainTable: 'categories',
    requiredFields: ['name'],
    optionalFields: ['description', 'parent_id', 'is_active'],
    autoGeneratedFields: ['id', 'created_at', 'updated_at'],
    relationships: ['categories.parent_id -> categories.id (self-referencing)']
}

### GET /api/products/units
database: {
    tables: ['units'],
    mainTable: 'units',
    fields: {
        units: ['id', 'name', 'symbol', 'description', 'is_active', 'created_at', 'updated_at']
    }
}

### POST /api/products/units
database: {
    tables: ['units'],
    mainTable: 'units',
    requiredFields: ['name', 'symbol'],
    optionalFields: ['description', 'is_active'],
    autoGeneratedFields: ['id', 'created_at', 'updated_at']
}

## Sales Module - Remaining Routes

### GET /api/sales/orders/:id
database: {
    tables: ['orders', 'order_items', 'customers', 'products', 'invoices', 'payments'],
    mainTable: 'orders',
    fields: {
        orders: ['id', 'order_number', 'customer_id', 'order_date', 'status', 'total_amount', 'tax_amount', 'discount_amount', 'shipping_address', 'billing_address', 'payment_status', 'notes', 'created_at'],
        customers: ['id', 'name', 'email', 'phone', 'company'],
        order_items: ['id', 'order_id', 'product_id', 'quantity', 'unit_price', 'discount', 'line_total'],
        products: ['id', 'name', 'sku', 'price', 'image_url'],
        invoices: ['id', 'invoice_number', 'order_id', 'total_amount', 'status'],
        payments: ['id', 'order_id', 'amount', 'payment_method', 'status']
    },
    relationships: [
        'orders.customer_id -> customers.id (FK)',
        'order_items.order_id -> orders.id (FK)',
        'order_items.product_id -> products.id (FK)',
        'invoices.order_id -> orders.id (FK)',
        'payments.order_id -> orders.id (FK)'
    ]
}

### PUT /api/sales/orders/:id
database: {
    tables: ['orders'],
    mainTable: 'orders',
    updatableFields: ['status', 'shipping_address', 'billing_address', 'notes'],
    readOnlyFields: ['id', 'order_number', 'total_amount', 'created_at'],
    autoUpdatedFields: ['updated_at']
}

### DELETE /api/sales/orders/:id
database: {
    tables: ['orders', 'order_items', 'invoices', 'payments', 'deliveries'],
    mainTable: 'orders',
    cascadeDeletes: ['order_items', 'invoices', 'payments', 'deliveries']
}

### POST /api/sales/orders/invoices
database: {
    tables: ['invoices', 'orders'],
    mainTable: 'invoices',
    requiredFields: ['order_id'],
    optionalFields: ['due_date'],
    autoGeneratedFields: ['id', 'invoice_number', 'total_amount', 'invoice_date', 'created_at'],
    relationships: ['invoices.order_id -> orders.id (FK)']
}

### GET /api/sales/orders/invoices/:id
database: {
    tables: ['invoices', 'orders', 'customers', 'payments'],
    mainTable: 'invoices',
    fields: {
        invoices: ['id', 'invoice_number', 'order_id', 'invoice_date', 'due_date', 'total_amount', 'status', 'created_at'],
        orders: ['id', 'order_number', 'customer_id', 'total_amount'],
        customers: ['id', 'name', 'email', 'phone', 'company'],
        payments: ['id', 'invoice_id', 'amount', 'payment_date', 'payment_method']
    },
    relationships: [
        'invoices.order_id -> orders.id (FK)',
        'orders.customer_id -> customers.id (FK)',
        'payments.invoice_id -> invoices.id (FK)'
    ]
}

### POST /api/sales/orders/payments
database: {
    tables: ['payments', 'orders', 'invoices'],
    mainTable: 'payments',
    requiredFields: ['order_id', 'amount', 'payment_method'],
    optionalFields: ['invoice_id', 'reference_number'],
    autoGeneratedFields: ['id', 'payment_date', 'created_at'],
    relationships: [
        'payments.order_id -> orders.id (FK)',
        'payments.invoice_id -> invoices.id (FK)'
    ]
}

### GET /api/sales/orders/payments/:id
database: {
    tables: ['payments', 'orders', 'invoices', 'customers'],
    mainTable: 'payments',
    fields: {
        payments: ['id', 'order_id', 'invoice_id', 'amount', 'payment_date', 'payment_method', 'reference_number', 'status', 'created_at'],
        orders: ['id', 'order_number', 'customer_id'],
        invoices: ['id', 'invoice_number'],
        customers: ['id', 'name', 'email', 'phone', 'company']
    },
    relationships: [
        'payments.order_id -> orders.id (FK)',
        'payments.invoice_id -> invoices.id (FK)',
        'orders.customer_id -> customers.id (FK)'
    ]
}

### POST /api/sales/orders/:id/deliver
database: {
    tables: ['deliveries', 'orders'],
    mainTable: 'deliveries',
    requiredFields: ['status'],
    optionalFields: ['delivery_date', 'delivery_address', 'delivery_person_name', 'delivery_person_phone', 'tracking_number', 'notes'],
    autoGeneratedFields: ['id', 'delivery_number', 'delivered_at', 'created_at'],
    relationships: ['deliveries.order_id -> orders.id (FK)'],
    sideEffects: [
        'Updates orders.status to delivered (if status=delivered)',
        'Updates orders.status to shipped (if status=in_transit)',
        'Sets deliveries.delivered_at timestamp when status is delivered'
    ]
}

## Purchase Module - Remaining Routes

### GET /api/purchase/orders/:id
database: {
    tables: ['purchase_orders', 'purchase_order_items', 'suppliers', 'products', 'purchase_invoices', 'purchase_payments'],
    mainTable: 'purchase_orders',
    fields: {
        purchase_orders: ['id', 'po_number', 'supplier_id', 'order_date', 'expected_delivery_date', 'status', 'total_amount', 'tax_amount', 'discount_amount', 'payment_status', 'notes', 'created_at'],
        suppliers: ['id', 'name', 'email', 'phone', 'contact_person'],
        purchase_order_items: ['id', 'purchase_order_id', 'product_id', 'quantity', 'unit_cost', 'discount', 'line_total'],
        products: ['id', 'name', 'sku', 'price', 'image_url'],
        purchase_invoices: ['id', 'invoice_number', 'purchase_order_id', 'total_amount', 'status'],
        purchase_payments: ['id', 'purchase_order_id', 'amount', 'payment_method', 'status']
    },
    relationships: [
        'purchase_orders.supplier_id -> suppliers.id (FK)',
        'purchase_order_items.purchase_order_id -> purchase_orders.id (FK)',
        'purchase_order_items.product_id -> products.id (FK)',
        'purchase_invoices.purchase_order_id -> purchase_orders.id (FK)',
        'purchase_payments.purchase_order_id -> purchase_orders.id (FK)'
    ]
}

### PUT /api/purchase/orders/:id
database: {
    tables: ['purchase_orders'],
    mainTable: 'purchase_orders',
    updatableFields: ['status', 'expected_delivery_date', 'notes'],
    readOnlyFields: ['id', 'po_number', 'total_amount', 'created_at'],
    autoUpdatedFields: ['updated_at']
}

### DELETE /api/purchase/orders/:id
database: {
    tables: ['purchase_orders', 'purchase_order_items', 'purchase_invoices', 'purchase_payments', 'purchase_receipts'],
    mainTable: 'purchase_orders',
    cascadeDeletes: ['purchase_order_items', 'purchase_invoices', 'purchase_payments', 'purchase_receipts']
}

### POST /api/purchase/orders/invoices
database: {
    tables: ['purchase_invoices', 'purchase_orders'],
    mainTable: 'purchase_invoices',
    requiredFields: ['purchase_order_id'],
    optionalFields: ['due_date'],
    autoGeneratedFields: ['id', 'invoice_number', 'total_amount', 'invoice_date', 'created_at'],
    relationships: ['purchase_invoices.purchase_order_id -> purchase_orders.id (FK)']
}

### GET /api/purchase/orders/invoices/:id
database: {
    tables: ['purchase_invoices', 'purchase_orders', 'suppliers', 'purchase_payments'],
    mainTable: 'purchase_invoices',
    fields: {
        purchase_invoices: ['id', 'invoice_number', 'purchase_order_id', 'invoice_date', 'due_date', 'total_amount', 'status', 'created_at'],
        purchase_orders: ['id', 'po_number', 'supplier_id', 'total_amount'],
        suppliers: ['id', 'name', 'email', 'phone', 'contact_person'],
        purchase_payments: ['id', 'invoice_id', 'amount', 'payment_date', 'payment_method']
    },
    relationships: [
        'purchase_invoices.purchase_order_id -> purchase_orders.id (FK)',
        'purchase_orders.supplier_id -> suppliers.id (FK)',
        'purchase_payments.invoice_id -> purchase_invoices.id (FK)'
    ]
}

### POST /api/purchase/orders/payments
database: {
    tables: ['purchase_payments', 'purchase_orders', 'purchase_invoices'],
    mainTable: 'purchase_payments',
    requiredFields: ['purchase_order_id', 'amount', 'payment_method'],
    optionalFields: ['invoice_id', 'reference_number'],
    autoGeneratedFields: ['id', 'payment_date', 'created_at'],
    relationships: [
        'purchase_payments.purchase_order_id -> purchase_orders.id (FK)',
        'purchase_payments.invoice_id -> purchase_invoices.id (FK)'
    ]
}

### GET /api/purchase/orders/payments/:id
database: {
    tables: ['purchase_payments', 'purchase_orders', 'purchase_invoices', 'suppliers'],
    mainTable: 'purchase_payments',
    fields: {
        purchase_payments: ['id', 'purchase_order_id', 'invoice_id', 'amount', 'payment_date', 'payment_method', 'reference_number', 'status', 'created_at'],
        purchase_orders: ['id', 'po_number', 'supplier_id'],
        purchase_invoices: ['id', 'invoice_number'],
        suppliers: ['id', 'name', 'email', 'phone', 'contact_person']
    },
    relationships: [
        'purchase_payments.purchase_order_id -> purchase_orders.id (FK)',
        'purchase_payments.invoice_id -> purchase_invoices.id (FK)',
        'purchase_orders.supplier_id -> suppliers.id (FK)'
    ]
}

## Customers Module

### GET /api/customers/
database: {
    tables: ['customers'],
    mainTable: 'customers',
    fields: {
        customers: ['id', 'name', 'email', 'phone', 'company', 'address', 'city', 'state', 'country', 'postal_code', 'tax_id', 'credit_limit', 'payment_terms', 'notes', 'is_active', 'created_at', 'updated_at']
    }
}

### POST /api/customers/
database: {
    tables: ['customers'],
    mainTable: 'customers',
    requiredFields: ['name'],
    optionalFields: ['email', 'phone', 'company', 'address', 'city', 'state', 'country', 'postal_code', 'tax_id', 'credit_limit', 'payment_terms', 'notes', 'is_active'],
    autoGeneratedFields: ['id', 'created_at', 'updated_at']
}

### GET /api/customers/:id
database: {
    tables: ['customers'],
    mainTable: 'customers',
    fields: {
        customers: ['id', 'name', 'email', 'phone', 'company', 'address', 'city', 'state', 'country', 'postal_code', 'tax_id', 'credit_limit', 'payment_terms', 'notes', 'is_active', 'created_at', 'updated_at']
    }
}

### PUT /api/customers/:id
database: {
    tables: ['customers'],
    mainTable: 'customers',
    updatableFields: ['name', 'email', 'phone', 'company', 'address', 'city', 'state', 'country', 'postal_code', 'tax_id', 'credit_limit', 'payment_terms', 'notes', 'is_active'],
    readOnlyFields: ['id', 'created_at'],
    autoUpdatedFields: ['updated_at']
}

### DELETE /api/customers/:id
database: {
    tables: ['customers', 'orders'],
    mainTable: 'customers',
    sideEffects: ['May affect existing orders - check foreign key constraints']
}

## Suppliers Module

### GET /api/suppliers/
database: {
    tables: ['suppliers'],
    mainTable: 'suppliers',
    fields: {
        suppliers: ['id', 'name', 'contact_person', 'email', 'phone', 'address', 'city', 'state', 'country', 'postal_code', 'latitude', 'longitude', 'tax_id', 'website', 'payment_terms', 'notes', 'is_active', 'created_at', 'updated_at']
    }
}

### POST /api/suppliers/
database: {
    tables: ['suppliers'],
    mainTable: 'suppliers',
    requiredFields: ['name'],
    optionalFields: ['contact_person', 'email', 'phone', 'address', 'city', 'state', 'country', 'postal_code', 'latitude', 'longitude', 'tax_id', 'website', 'payment_terms', 'notes', 'is_active'],
    autoGeneratedFields: ['id', 'created_at', 'updated_at']
}

### GET /api/suppliers/:id
database: {
    tables: ['suppliers'],
    mainTable: 'suppliers',
    fields: {
        suppliers: ['id', 'name', 'contact_person', 'email', 'phone', 'address', 'city', 'state', 'country', 'postal_code', 'latitude', 'longitude', 'tax_id', 'website', 'payment_terms', 'notes', 'is_active', 'created_at', 'updated_at']
    }
}

### PUT /api/suppliers/:id
database: {
    tables: ['suppliers'],
    mainTable: 'suppliers',
    updatableFields: ['name', 'contact_person', 'email', 'phone', 'address', 'city', 'state', 'country', 'postal_code', 'latitude', 'longitude', 'tax_id', 'website', 'payment_terms', 'notes', 'is_active'],
    readOnlyFields: ['id', 'created_at'],
    autoUpdatedFields: ['updated_at']
}

### DELETE /api/suppliers/:id
database: {
    tables: ['suppliers', 'purchase_orders'],
    mainTable: 'suppliers',
    sideEffects: ['May affect existing purchase orders - check foreign key constraints']
}
